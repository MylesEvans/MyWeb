<script>
  const urlParams = new URLSearchParams(window.location.search);
  const query = urlParams.get('q');

  // Easter Egg check
  if (query && (query.toLowerCase() === 'ralph' || query.toLowerCase() === 'ralphie')) {
    triggerFrogEasterEgg();
  } else {
    fetchResults();
    fetchWikipedia();
  }

  function triggerFrogEasterEgg() {
    const frogs = [];
    const numFrogs = 15; // number of frogs to spawn

    for (let i = 0; i < numFrogs; i++) {
      const frog = document.createElement('img');
      frog.src = 'frog.png'; // use your local frog.png
      frog.style.position = 'fixed';
      frog.style.width = '60px';
      frog.style.left = Math.random() * window.innerWidth + 'px';
      frog.style.top = Math.random() * window.innerHeight + 'px';
      frog.style.transition = 'transform 1s ease-out, top 1s ease-out';
      frog.style.zIndex = 9999;
      document.body.appendChild(frog);
      frogs.push(frog);

      // make each frog jump randomly after a random delay
      setTimeout(() => {
        const jumpHeight = Math.random() * 150 + 50; // jump 50-200px
        frog.style.top = (parseFloat(frog.style.top) - jumpHeight) + 'px';
        frog.style.transform = `rotate(${Math.random() * 360}deg) scale(${0.8 + Math.random() * 0.4})`;
      }, Math.random() * 1000);
    }

    // redirect after 3 seconds
    setTimeout(() => {
      window.location.href = 'results.html?q=frog';
    }, 3000);
  }

  async function fetchResults() {
    const resultsDiv = document.getElementById('results');
    const apiUrl = `https://bob.mylesjohn2012.workers.dev/?q=${encodeURIComponent(query)}`;
    try {
      const response = await fetch(apiUrl);
      const data = await response.json();
      resultsDiv.innerHTML = '';

      if (data.items) {
        data.items.forEach(item => {
          const result = document.createElement('div');
          result.className = 'result-item';
          result.innerHTML = `
            <h3><a href="${item.link}" target="_blank">${item.title}</a></h3>
            <div style="display: flex; gap: 10px;">
              <img src="${item.image || 'default-thumb.png'}" alt="Thumbnail" style="width: 100px; height: auto; border-radius: 8px;">
              <p>${item.snippet}</p>
            </div>
          `;
          resultsDiv.appendChild(result);
        });
      } else {
        resultsDiv.innerHTML = '<p>No results found.</p>';
      }
    } catch (error) {
      console.error('Search error:', error);
      resultsDiv.innerHTML = '<p>Something went wrong.</p>';
    }
  }

  async function fetchWikipedia() {
    const wikiDiv = document.getElementById('wikipedia');
    const wikiApiUrl = `https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(query)}`;
    try {
      const response = await fetch(wikiApiUrl);
      const data = await response.json();
      if (data && data.extract) {
        wikiDiv.innerHTML = `
          <h3>${data.title}</h3>
          <p>${data.extract}</p>
          <a href="${data.content_urls.desktop.page}" target="_blank">Read more on Wikipedia</a>
        `;
      }
    } catch (error) {
      console.error('Wikipedia error:', error);
      wikiDiv.innerHTML = '';
    }
  }
</script>
